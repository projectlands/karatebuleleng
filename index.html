<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>KATA KARATE</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
  </head>
  <body>
    

    <div class="container mt-4">
        <div class="row">
            <div class="col-md-6 mb-4">
                <div class="card">
                    <div class="card-header">
                        <strong>KELAS KATA</strong> 
                        <select class="form-select" aria-label="Default select example" id="fileSelectKata">
                            <option selected>Pilih Kelas</option>
                          </select>
                    </div>
                    <div class="card-body">
                        <div class="d-flex justify-content-center" >
                            <div class="spinner-border text-primary" role="status" id="loadingSpinner" style="display: none;">
                              <span class="visually-hidden">Loading...</span>
                            </div>
                          </div>
                        <div class="data-kata" style="display: none;">
                            <div id="dataTableContainer" class="table-responsive"></div>
                        </div>
                        
                    </div>
                </div>
            </div>
            <div class="col-md-6 mb-4">
                <div class="card">
                    <div class="card-header">
                        
                        <strong>KELAS KARATE</strong>
                        
                        <select class="form-select" aria-label="Default select example" id="fileSelectKarate">
                            <option selected>Pilih Kelas</option>
                          </select>
                    </div>
                    <div class="card-body">
                        <div class="d-flex justify-content-center" >
                            <div class="spinner-border text-primary" role="status" id="loadingSpinner2" style="display: none;">
                              <span class="visually-hidden">Loading...</span>
                            </div>
                          </div>
                        <div class="data-karate" style="display: none;">
                            <div id="dataTableContainer2" class="table-responsive"></div>
                        </div>
                        
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        // Fungsi untuk melakukan permintaan fetch ke URL tertentu dan menampilkan data ke dalam <select>
        function fetchDataAndPopulateSelect(url) {
            const fileSelect = document.getElementById('fileSelectKata');

            fetch(url)
                .then(response => {
                    // Memeriksa apakah respons dari permintaan adalah OK (berhasil)
                    if (!response.ok) {
                        throw new Error('Network response was not ok');
                    }
                    // Mengembalikan respons dalam bentuk JSON
                    return response.json();
                })
                .then(data => {

                    // Mengurutkan data berdasarkan nama file (ascending)
                    data.sort((a, b) => a.name.localeCompare(b.name));

                    // Menggunakan data yang diterima untuk membuat <option> dalam <select>
                    data.forEach(file => {
                        const option = document.createElement('option');
                        option.value = file.id;
                        option.textContent = file.name;
                        fileSelect.appendChild(option);
                    });
                })
                .catch(error => {
                    // Menangani kesalahan jika terjadi
                    console.error('Terjadi kesalahan:', error);
                });
        }

        // Panggil fungsi fetchDataAndPopulateSelect saat halaman selesai dimuat
        document.addEventListener('DOMContentLoaded', () => {
            const apiUrl = 'https://script.google.com/macros/s/AKfycbynrULeWAhlb8HThTEcXhwWlPgBbse4n0YxcGRHNz0r0hMarZXK0RI9A9KZB99K1v-I/exec'; // Ganti URL_WEB_APP dengan URL web app yang sesuai
            fetchDataAndPopulateSelect(apiUrl);
        });
    
        // Fungsi untuk melakukan permintaan fetch ke URL tertentu dan menampilkan data ke dalam <select>
            function fetchDataAndPopulateSelect2(url2) {
            const fileSelect = document.getElementById('fileSelectKarate');

            fetch(url2)
                .then(response => {
                    // Memeriksa apakah respons dari permintaan adalah OK (berhasil)
                    if (!response.ok) {
                        throw new Error('Network response was not ok');
                    }
                    // Mengembalikan respons dalam bentuk JSON
                    return response.json();
                })
                .then(data => {

                    // Mengurutkan data berdasarkan nama file (ascending)
                    data.sort((a, b) => a.name.localeCompare(b.name));

                    // Menggunakan data yang diterima untuk membuat <option> dalam <select>
                    data.forEach(file => {
                        const option = document.createElement('option');
                        option.value = file.id;
                        option.textContent = file.name;
                        fileSelect.appendChild(option);
                    });
                })
                .catch(error => {
                    // Menangani kesalahan jika terjadi
                    console.error('Terjadi kesalahan:', error);
                });
        }

        // Panggil fungsi fetchDataAndPopulateSelect saat halaman selesai dimuat
        document.addEventListener('DOMContentLoaded', () => {
            const apiUrl2 = 'https://script.google.com/macros/s/AKfycbw4LSq3RhG6kxnh7qzaI13yJdgqIGDXd8Vw3J_vxPjD91VteEAVBqdCJP36NAS5IC4afQ/exec'; // Ganti URL_WEB_APP dengan URL web app yang sesuai
            fetchDataAndPopulateSelect2(apiUrl2);
        });



       // Fungsi untuk mengambil data dari web app (Google Apps Script) dan menampilkan dalam tabel di card body
       function fetchDataFromWebApp(spreadsheetId) {
            const url = `https://script.google.com/macros/s/AKfycbx1HSd-PeSYbiP_tgmxLEH-EujBjI12dpZezNNokXe6MFT3BWUl50GVYNXQU_tgCZ5OKw/exec?id=${spreadsheetId}`; // Ganti URL_WEB_APP dengan URL web app yang telah Anda deploy

            // Tampilkan loading spinner saat memuat data
            const loadingSpinner = document.getElementById('loadingSpinner');
            loadingSpinner.style.display = 'block';

            fetch(url)
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Network response was not ok');
                    }
                    return response.json();
                })
                .then(data => {

                    // Sembunyikan loading spinner setelah data diterima
                    loadingSpinner.style.display = 'none';

                    // Menghapus card yang sebelumnya ditampilkan (jika ada)
                    const card = document.querySelector('.data-kata');
                    if (card) {
                        card.style.display = 'none';
                    }

                    // Membuat tabel HTML dari data
                    const table = document.createElement('table');
                    table.className = 'table table-hover';

                    // Membuat header tabel dari keys (nama kolom) pada objek pertama
                    const headers = Object.keys(data[0]);
                    const headerRow = table.insertRow();
                    headers.forEach(header => {
                        const th = document.createElement('th');
                        th.textContent = header;
                        headerRow.appendChild(th);
                    });

                    // Memasukkan data ke dalam baris tabel
                    data.forEach(item => {
                        const row = table.insertRow();
                        headers.forEach(header => {
                            const cell = row.insertCell();
                            cell.textContent = item[header];
                        });
                    });

                    // Menampilkan tabel dalam card body
                    const dataTableContainer = document.getElementById('dataTableContainer');
                    dataTableContainer.innerHTML = ''; // Kosongkan konten sebelumnya
                    dataTableContainer.appendChild(table);

                    // Tampilkan card dengan tabel
                    card.style.display = 'block';
                    dataTableContainer.style.display = 'block'; // Tampilkan container tabel
                })
                .catch(error => {
                    console.error('Error fetching data from web app:', error);
                    // Sembunyikan loading spinner setelah data diterima
                    loadingSpinner.style.display = 'none';
                });
        }

        // Panggil fungsi fetchDataFromWebApp saat <select> dipilih
        document.getElementById('fileSelectKata').addEventListener('change', event => {
            const selectedSpreadsheetId = event.target.value;
            if (selectedSpreadsheetId) {
                fetchDataFromWebApp(selectedSpreadsheetId);
            }
        });



          // Fungsi untuk mengambil data dari web app (Google Apps Script) dan menampilkan dalam tabel di card body
       function fetchDataFromWebApp2(spreadsheetId) {
            const url = `https://script.google.com/macros/s/AKfycbyUMH6blY56pTV4EnpbqZCVse3Cj-nTwfyJ8NOoVaKm2TNH_bs8BDLdqM9xHwH7-giI/exec?id=${spreadsheetId}`; // Ganti URL_WEB_APP dengan URL web app yang telah Anda deploy || script di buat di email maclodas

            // Tampilkan loading spinner saat memuat data
            const loadingSpinner = document.getElementById('loadingSpinner2');
            loadingSpinner.style.display = 'block';

            fetch(url)
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Network response was not ok');
                    }
                    return response.json();
                })
                .then(data => {

                    // Sembunyikan loading spinner setelah data diterima
                    loadingSpinner.style.display = 'none';

                    // Menghapus card yang sebelumnya ditampilkan (jika ada)
                    const card = document.querySelector('.data-karate');
                    if (card) {
                        card.style.display = 'none';
                    }

                    // Membuat tabel HTML dari data
                    const table = document.createElement('table');
                    table.className = 'table table-hover';

                    // Membuat header tabel dari keys (nama kolom) pada objek pertama
                    const headers = Object.keys(data[0]);
                    const headerRow = table.insertRow();
                    headers.forEach(header => {
                        const th = document.createElement('th');
                        th.textContent = header;
                        headerRow.appendChild(th);
                    });

                    // Memasukkan data ke dalam baris tabel
                    data.forEach(item => {
                        const row = table.insertRow();
                        headers.forEach(header => {
                            const cell = row.insertCell();
                            cell.textContent = item[header];
                        });
                    });

                    // Menampilkan tabel dalam card body
                    const dataTableContainer = document.getElementById('dataTableContainer2');
                    dataTableContainer.innerHTML = ''; // Kosongkan konten sebelumnya
                    dataTableContainer.appendChild(table);

                    // Tampilkan card dengan tabel
                    card.style.display = 'block';
                    dataTableContainer.style.display = 'block'; // Tampilkan container tabel
                })
                .catch(error => {
                    console.error('Error fetching data from web app:', error);
                    // Sembunyikan loading spinner setelah data diterima
                    loadingSpinner.style.display = 'none';
                });
        }

        // Panggil fungsi fetchDataFromWebApp saat <select> dipilih
        document.getElementById('fileSelectKarate').addEventListener('change', event => {
            const selectedSpreadsheetId = event.target.value;
            if (selectedSpreadsheetId) {
                fetchDataFromWebApp2(selectedSpreadsheetId);
            }
        });


    </script>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
  </body>
</html>